<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sanitized HTML View</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-2xl mx-auto py-8 px-4">
        <a href="/" class="inline-flex items-center mb-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition font-semibold text-sm"><i data-feather="arrow-left" class="w-4 h-4 mr-2"></i> Back to Dashboard</a>
        {% if risk_level == 'high' or risk_level == 'harmful' or unsafe_content_removed %}
        <div class="alert alert-danger d-flex align-items-center mb-3" role="alert" style="font-size:1rem;">
            <i data-feather="alert-triangle" class="me-2"></i>
            <div><strong>Unsafe Content Removed:</strong> This page contained potentially harmful content and has been sanitized for safe viewing.</div>
        </div>
        {% else %}
        <div class="alert alert-success d-flex align-items-center mb-3" role="alert" style="font-size:1rem;">
            <i data-feather="shield" class="me-2"></i>
            <div>This page has been sanitized and is considered safe for normal viewing. All dangerous elements have been removed.</div>
        </div>
        {% endif %}
        {% if has_clickables %}
        <div class="alert alert-warning d-flex align-items-center mb-3" role="alert" style="font-size:1rem;">
            <i data-feather="slash" class="me-2"></i>
            <span class="fw-bold me-1">Notice:</span> All clickable elements (links, buttons, forms, etc.) are visually present but have been disabled for your safety in this preview. Interactions will not work.
        </div>
        {% endif %}
    <div class="mt-8 rounded-xl shadow bg-white">
        <div class="px-6 py-3 bg-green-600 text-white rounded-t-xl flex items-center font-semibold"><i data-feather="eye" class="w-5 h-5 mr-2"></i> Sanitized Full Page Preview</div>
        <div class="px-6 py-4">
            <iframe id="sanitized-preview" sandbox="allow-same-origin" style="width:100%;min-height:400px;border:1px solid #ddd;"></iframe>
        </div>
    </div>
    <script>
        // Insert sanitized HTML into the iframe safely and disable interactions
        const iframe = document.getElementById('sanitized-preview');
        function disableIframeInteractions() {
          const win = iframe.contentWindow;
          const doc = iframe.contentDocument || win.document;
          // Disable all links
          doc.querySelectorAll('a').forEach(a => {
            a.removeAttribute('href');
            a.onclick = function(e) { e.preventDefault(); return false; };
            a.style.pointerEvents = 'auto';
            a.style.cursor = 'not-allowed';
          });
          // Disable all forms
          doc.querySelectorAll('form').forEach(f => {
            f.onsubmit = function(e) { e.preventDefault(); return false; };
          });
          // Disable all buttons and clickable inputs
          doc.querySelectorAll('button, input[type="submit"], input[type="button"], input[type="reset"]').forEach(btn => {
            btn.onclick = function(e) { e.preventDefault(); return false; };
            btn.disabled = true;
            btn.style.cursor = 'not-allowed';
          });
          // Inject script to disable navigation and click events
          const script = doc.createElement('script');
          script.textContent = `
            window.addEventListener('load', function() {
              window.addEventListener('click', function(e) { e.preventDefault(); return false; });
              window.addEventListener('submit', function(e) { e.preventDefault(); return false; });
              window.addEventListener('beforeunload', function(e) { e.preventDefault(); return false; });
            });
          `;
          doc.body.appendChild(script);
        }
        iframe.onload = function() { disableIframeInteractions(); };
        const doc = iframe.contentDocument || iframe.contentWindow.document;
        doc.open();
        doc.write(`{{ html|safe }}`);
        doc.close();
        setTimeout(disableIframeInteractions, 100);
    </script>
    <!-- Feather Icons: Local dynamic loader -->
    <script>
      function loadFeatherAndReplace() {
        if (typeof feather !== 'undefined') {
          feather.replace();
        } else {
          var script = document.createElement('script');
          script.src = '/static/js/feather.min.js';
          script.onload = function() {
            if (typeof feather !== 'undefined') feather.replace();
          };
          document.head.appendChild(script);
        }
      }
      loadFeatherAndReplace();
    </script>
</body>
</html>
